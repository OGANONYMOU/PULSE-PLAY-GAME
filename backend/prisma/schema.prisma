// ─────────────────────────────────────────────────────────────
//  PulsePay — Prisma Schema
// ─────────────────────────────────────────────────────────────

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  username       String    @unique
  firstName      String?
  lastName       String?
  phone          String?
  password       String?
  profilePicture String?
  bio            String?
  role           Role      @default(USER)
  isActive       Boolean   @default(true)
  isBanned       Boolean   @default(false)
  banReason      String?
  lastLoginAt    DateTime?
  loginCount     Int       @default(0)
  googleId       String?   @unique
  discordId      String?   @unique
  facebookId     String?   @unique
  twitterId      String?   @unique
  theme                String   @default("dark")
  emailNotifications   Boolean  @default(true)
  receiveUpdates       Boolean  @default(false)
  posts                    Post[]
  comments                 Comment[]
  tournamentParticipations TournamentParticipant[]
  gameStats                GameStat[]
  notifications            Notification[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([role])
  @@index([createdAt])
}

enum Role {
  USER
  MODERATOR
  ADMIN
}

model Game {
  id          String  @id @default(cuid())
  name        String
  category    String
  description String?
  icon        String?
  thumbnail   String?
  players     Int     @default(0)
  rating      Float   @default(0)
  isActive    Boolean @default(true)
  tournaments Tournament[]
  gameStats   GameStat[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
}

model GameStat {
  id          String @id @default(cuid())
  userId      String
  gameId      String
  gamesPlayed Int    @default(0)
  wins        Int    @default(0)
  losses      Int    @default(0)
  highScore   Int    @default(0)
  totalPoints Int    @default(0)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  game Game @relation(fields: [gameId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, gameId])
}

model Tournament {
  id              String           @id @default(cuid())
  name            String
  gameId          String
  description     String?
  prizePool       Float            @default(0)
  maxParticipants Int              @default(64)
  entryFee        Float            @default(0)
  status          TournamentStatus @default(UPCOMING)
  startDate       DateTime
  endDate         DateTime?
  rules           String?
  streamUrl       String?
  game         Game                   @relation(fields: [gameId], references: [id], onDelete: Cascade)
  participants TournamentParticipant[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([startDate])
}

enum TournamentStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

model TournamentParticipant {
  id           String @id @default(cuid())
  tournamentId String
  userId       String
  rank         Int?
  score        Int    @default(0)
  status       String @default("registered")
  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tournamentId, userId])
}

model Post {
  id       String  @id @default(cuid())
  userId   String
  content  String
  image    String?
  likes    Int     @default(0)
  category String  @default("general")
  isPinned Boolean @default(false)
  isHidden Boolean @default(false)
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments Comment[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([category])
  @@index([createdAt])
}

model Comment {
  id       String  @id @default(cuid())
  postId   String
  userId   String
  content  String
  isHidden Boolean @default(false)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notification {
  id      String  @id @default(cuid())
  userId  String
  type    String
  title   String
  message String
  read    Boolean @default(false)
  link    String?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, read])
}
